# üé® Gu√≠a Visual: Planes Nutricionales LIVE

## üìä Diagrama de Flujo: Ciclo de Vida de un Plan LIVE

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CREACI√ìN DEL PLAN LIVE                        ‚îÇ
‚îÇ                  (Trainer/Admin crea el plan)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CONFIGURACI√ìN INICIAL                         ‚îÇ
‚îÇ        ‚Ä¢ Establecer live_start_date                             ‚îÇ
‚îÇ        ‚Ä¢ Definir duration_days (ej: 21 d√≠as)                    ‚îÇ
‚îÇ        ‚Ä¢ Crear meals para cada d√≠a                              ‚îÇ
‚îÇ        ‚Ä¢ Marcar is_live_active = true                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì                                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PERIODO DE      ‚îÇ                        ‚îÇ   PLAN ACTIVO    ‚îÇ
‚îÇ  INSCRIPCI√ìN     ‚îÇ                        ‚îÇ   (D√≠a 4+)       ‚îÇ
‚îÇ  (D√≠as 1-3)      ‚îÇ                        ‚îÇ                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ Usuarios pueden‚îÇ                        ‚îÇ ‚ùå No m√°s        ‚îÇ
‚îÇ    unirse        ‚îÇ                        ‚îÇ    inscripciones ‚îÇ
‚îÇ ‚úÖ Notificaciones‚îÇ                        ‚îÇ ‚úÖ Sincronizaci√≥n‚îÇ
‚îÇ    de invitaci√≥n ‚îÇ                        ‚îÇ    diaria        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì                                               ‚Üì
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        D√çA A D√çA                                 ‚îÇ
‚îÇ   ‚Ä¢ Medianoche: Avance autom√°tico al siguiente d√≠a              ‚îÇ
‚îÇ   ‚Ä¢ 8 AM, 1 PM, 7 PM: Notificaciones de comidas                ‚îÇ
‚îÇ   ‚Ä¢ Usuarios completan meals                                    ‚îÇ
‚îÇ   ‚Ä¢ Actualizaci√≥n de estad√≠sticas grupales                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
                    (Despu√©s de duration_days)
                                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      FINALIZACI√ìN                                ‚îÇ
‚îÇ        ‚Ä¢ Plan pasa a ARCHIVED                                   ‚îÇ
‚îÇ        ‚Ä¢ Certificados de completaci√≥n                           ‚îÇ
‚îÇ        ‚Ä¢ Estad√≠sticas finales                                   ‚îÇ
‚îÇ        ‚Ä¢ is_live_active = false                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üóìÔ∏è Timeline Visual de un Plan LIVE de 7 D√≠as

```
Dic 20    Dic 21    Dic 22    Dic 23    Dic 24    Dic 25    Dic 26
D√≠a 1     D√≠a 2     D√≠a 3     D√≠a 4     D√≠a 5     D√≠a 6     D√≠a 7
START     ‚Üí         ‚Üí         CIERRE    ‚Üí         ‚Üí         END
  ‚Üì         ‚Üì         ‚Üì       INSCR.      ‚Üì         ‚Üì         ‚Üì
[====== INSCRIPCIONES OK ======][===== SOLO PARTICIPANTES =====]
  ‚Üì         ‚Üì         ‚Üì         ‚Üì         ‚Üì         ‚Üì         ‚Üì
üë• 10     üë• 25     üë• 40     üë• 40     üë• 40     üë• 40     üë• 40
users     users     users    (fijo)    (fijo)    (fijo)   (final)
```

## üîÑ Sincronizaci√≥n Autom√°tica de D√≠as

### Backend (Python)
```python
# app/services/nutrition_live_service.py
from datetime import datetime, timezone
from typing import Optional

class NutritionLiveService:
    @staticmethod
    def get_current_day_number(plan: NutritionPlan) -> int:
        """
        Calcula el d√≠a actual basado en live_start_date.
        Todos los usuarios ven el mismo d√≠a.
        """
        if not plan.live_start_date:
            return 1

        now = datetime.now(timezone.utc)
        start = plan.live_start_date.replace(tzinfo=timezone.utc)

        # Calcular d√≠as transcurridos
        days_elapsed = (now - start).days

        # El d√≠a actual es d√≠as transcurridos + 1
        current_day = min(days_elapsed + 1, plan.duration_days)

        return max(1, current_day)  # Nunca menos de d√≠a 1

    @staticmethod
    def can_user_join(plan: NutritionPlan) -> bool:
        """
        Los usuarios solo pueden unirse en los primeros 3 d√≠as.
        """
        current_day = NutritionLiveService.get_current_day_number(plan)
        return current_day <= 3 and plan.is_live_active

    @staticmethod
    def get_meals_for_today(plan: NutritionPlan) -> list:
        """
        Retorna las comidas del d√≠a actual para todos los participantes.
        """
        current_day = NutritionLiveService.get_current_day_number(plan)

        # Buscar el daily_plan correspondiente
        for daily_plan in plan.daily_plans:
            if daily_plan.day_number == current_day:
                return daily_plan.meals

        return []
```

### Frontend (React + TypeScript)
```tsx
// services/LivePlanSyncService.ts
export class LivePlanSyncService {
  /**
   * Calcula el d√≠a actual del plan LIVE
   */
  static getCurrentDay(liveStartDate: string, durationDays: number): number {
    const start = new Date(liveStartDate);
    const now = new Date();

    // Calcular diferencia en d√≠as
    const diffTime = Math.abs(now.getTime() - start.getTime());
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

    // D√≠a actual (1-indexed)
    const currentDay = Math.min(diffDays + 1, durationDays);
    return Math.max(1, currentDay);
  }

  /**
   * Determina si el plan acepta nuevos participantes
   */
  static canJoinPlan(liveStartDate: string): boolean {
    const currentDay = this.getCurrentDay(liveStartDate, 999);
    return currentDay <= 3;
  }

  /**
   * Calcula tiempo hasta el pr√≥ximo d√≠a
   */
  static getTimeUntilNextDay(): { hours: number; minutes: number } {
    const now = new Date();
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);

    const diff = tomorrow.getTime() - now.getTime();
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

    return { hours, minutes };
  }
}
```

## üì± Componentes UI Espec√≠ficos para LIVE

### 1. Indicador de Sincronizaci√≥n
```tsx
// components/LiveSyncIndicator.tsx
export function LiveSyncIndicator({ participantCount, currentDay, totalDays }) {
  const [pulse, setPulse] = useState(true);

  useEffect(() => {
    const interval = setInterval(() => setPulse(p => !p), 2000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="live-sync-indicator">
      <div className={`live-dot ${pulse ? 'pulse' : ''}`}>
        <span className="dot"></span>
      </div>
      <div className="sync-info">
        <h4>üî¥ PLAN EN VIVO</h4>
        <p>D√≠a {currentDay} de {totalDays}</p>
        <p>{participantCount} participantes sincronizados</p>
      </div>
    </div>
  );
}
```

```css
/* styles/LiveSync.css */
.live-sync-indicator {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
  border-radius: 12px;
  color: white;
}

.live-dot {
  position: relative;
  width: 24px;
  height: 24px;
}

.live-dot .dot {
  position: absolute;
  width: 12px;
  height: 12px;
  background: white;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.live-dot.pulse::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}
```

### 2. Countdown hasta el Pr√≥ximo D√≠a
```tsx
// components/NextDayCountdown.tsx
export function NextDayCountdown() {
  const [timeLeft, setTimeLeft] = useState({ hours: 0, minutes: 0, seconds: 0 });

  useEffect(() => {
    const timer = setInterval(() => {
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(0, 0, 0, 0);

      const diff = tomorrow.getTime() - now.getTime();

      setTimeLeft({
        hours: Math.floor(diff / (1000 * 60 * 60)),
        minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),
        seconds: Math.floor((diff % (1000 * 60)) / 1000)
      });
    }, 1000);

    return () => clearInterval(timer);
  }, []);

  return (
    <div className="countdown-container">
      <h4>‚è∞ Pr√≥ximo d√≠a en:</h4>
      <div className="countdown-display">
        <div className="time-unit">
          <span className="time-value">{timeLeft.hours.toString().padStart(2, '0')}</span>
          <span className="time-label">HRS</span>
        </div>
        <span className="separator">:</span>
        <div className="time-unit">
          <span className="time-value">{timeLeft.minutes.toString().padStart(2, '0')}</span>
          <span className="time-label">MIN</span>
        </div>
        <span className="separator">:</span>
        <div className="time-unit">
          <span className="time-value">{timeLeft.seconds.toString().padStart(2, '0')}</span>
          <span className="time-label">SEG</span>
        </div>
      </div>
    </div>
  );
}
```

### 3. Progreso Grupal en Tiempo Real
```tsx
// components/GroupProgress.tsx
export function GroupProgress({ planId }) {
  const [stats, setStats] = useState(null);

  useEffect(() => {
    // Actualizar cada minuto
    const fetchStats = async () => {
      const response = await fetch(`/api/v1/nutrition/plans/${planId}/group-stats`);
      const data = await response.json();
      setStats(data);
    };

    fetchStats();
    const interval = setInterval(fetchStats, 60000);
    return () => clearInterval(interval);
  }, [planId]);

  if (!stats) return null;

  return (
    <div className="group-progress">
      <h3>üìä Progreso del Grupo Hoy</h3>

      <div className="progress-grid">
        <div className="stat-card">
          <div className="stat-icon">üç≥</div>
          <div className="stat-value">{stats.breakfast_completed}%</div>
          <div className="stat-label">Desayunaron</div>
        </div>

        <div className="stat-card">
          <div className="stat-icon">ü•ó</div>
          <div className="stat-value">{stats.lunch_completed}%</div>
          <div className="stat-label">Almorzaron</div>
        </div>

        <div className="stat-card">
          <div className="stat-icon">üçΩÔ∏è</div>
          <div className="stat-value">{stats.dinner_completed}%</div>
          <div className="stat-label">Cenaron</div>
        </div>
      </div>

      <div className="leaderboard">
        <h4>üèÜ Top Participantes</h4>
        {stats.top_performers.map((user, idx) => (
          <div key={user.id} className="leaderboard-item">
            <span className="rank">{idx + 1}</span>
            <span className="name">{user.name}</span>
            <span className="completion">{user.completion_rate}%</span>
          </div>
        ))}
      </div>
    </div>
  );
}
```

## üîî Sistema de Notificaciones LIVE

### Configuraci√≥n de OneSignal
```tsx
// services/LiveNotifications.ts
export class LiveNotificationService {
  static setupLiveNotifications(userId: number, planId: number) {
    // Suscribir a tags espec√≠ficos del plan LIVE
    OneSignal.sendTags({
      live_plan_id: planId.toString(),
      user_type: 'live_participant',
      notification_time: 'default' // 8am, 1pm, 7pm
    });

    // Handlers para diferentes tipos de notificaciones
    OneSignal.addEventListener('received', (notification) => {
      const { type, data } = notification.payload.additionalData;

      switch(type) {
        case 'live_new_day':
          this.handleNewDay(data);
          break;
        case 'live_meal_reminder':
          this.handleMealReminder(data);
          break;
        case 'live_group_achievement':
          this.handleGroupAchievement(data);
          break;
      }
    });
  }

  static handleNewDay(data: any) {
    // Mostrar toast/modal
    toast.info(`üåÖ ¬°D√≠a ${data.day_number} disponible!`, {
      action: {
        label: 'Ver Plan',
        onClick: () => window.location.href = `/nutrition/live/${data.plan_id}`
      }
    });
  }

  static handleMealReminder(data: any) {
    // Notificaci√≥n con acci√≥n directa
    toast.warning(`üçΩÔ∏è Hora de ${data.meal_type_display}`, {
      duration: 10000,
      action: {
        label: 'Marcar Completado',
        onClick: () => this.completeMeal(data.meal_id)
      }
    });
  }

  static handleGroupAchievement(data: any) {
    // Celebraci√≥n grupal
    confetti();
    toast.success(`üéâ ${data.message}`);
  }
}
```

## üìä M√©tricas y Analytics para LIVE

### Dashboard de Administrador
```tsx
// components/admin/LivePlanDashboard.tsx
export function LivePlanDashboard({ planId }) {
  const [metrics, setMetrics] = useState(null);

  useEffect(() => {
    fetchMetrics();
  }, [planId]);

  const fetchMetrics = async () => {
    const response = await fetch(`/api/v1/admin/nutrition/plans/${planId}/metrics`);
    const data = await response.json();
    setMetrics(data);
  };

  if (!metrics) return <Loading />;

  return (
    <div className="admin-dashboard">
      <h2>Dashboard del Plan LIVE</h2>

      {/* KPIs principales */}
      <div className="kpi-grid">
        <KPICard
          title="Participantes Activos"
          value={metrics.active_participants}
          total={metrics.total_participants}
          icon="üë•"
        />
        <KPICard
          title="Tasa de Completaci√≥n"
          value={`${metrics.completion_rate}%`}
          trend={metrics.completion_trend}
          icon="‚úÖ"
        />
        <KPICard
          title="Engagement Diario"
          value={`${metrics.daily_engagement}%`}
          subtitle="Usuarios que completaron al menos 1 comida"
          icon="üìä"
        />
      </div>

      {/* Gr√°fica de progreso diario */}
      <div className="chart-container">
        <h3>Progreso por D√≠a</h3>
        <LineChart
          data={metrics.daily_progress}
          xAxis="day"
          yAxis="completion_percentage"
          color="#4CAF50"
        />
      </div>

      {/* Tabla de participantes */}
      <div className="participants-table">
        <h3>Detalle de Participantes</h3>
        <table>
          <thead>
            <tr>
              <th>Usuario</th>
              <th>D√≠as Completados</th>
              <th>% Comidas</th>
              <th>√öltima Actividad</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {metrics.participants.map(p => (
              <tr key={p.user_id}>
                <td>{p.name}</td>
                <td>{p.days_completed}/{metrics.total_days}</td>
                <td>{p.meals_completion}%</td>
                <td>{formatDate(p.last_activity)}</td>
                <td>
                  <StatusBadge status={p.status} />
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
```

## üéØ Casos de Uso Espec√≠ficos

### Caso 1: Usuario se une a plan LIVE
```tsx
async function handleJoinLivePlan(planId: number) {
  try {
    // 1. Verificar elegibilidad
    const planInfo = await api.get(`/plans/${planId}`);
    if (!LivePlanSyncService.canJoinPlan(planInfo.live_start_date)) {
      throw new Error('Este plan ya no acepta nuevos participantes');
    }

    // 2. Unirse al plan
    await api.post(`/plans/${planId}/follow`);

    // 3. Configurar notificaciones
    LiveNotificationService.setupLiveNotifications(userId, planId);

    // 4. Redirigir al plan
    navigate(`/nutrition/live/${planId}`);

  } catch (error) {
    toast.error(error.message);
  }
}
```

### Caso 2: Cambio de d√≠a autom√°tico
```tsx
// Hook para detectar cambio de d√≠a
function useAutoRefreshOnNewDay(planId: number) {
  useEffect(() => {
    const checkForNewDay = () => {
      const now = new Date();

      // Si son las 00:00-00:05
      if (now.getHours() === 0 && now.getMinutes() < 5) {
        // Refrescar datos del plan
        window.location.reload();
      }
    };

    // Revisar cada minuto
    const interval = setInterval(checkForNewDay, 60000);
    return () => clearInterval(interval);
  }, [planId]);
}
```

### Caso 3: Mostrar d√≠as bloqueados
```tsx
function DaySelector({ plan, currentDay }) {
  return (
    <div className="day-selector">
      {Array.from({ length: plan.duration_days }, (_, i) => i + 1).map(day => (
        <button
          key={day}
          className={`day-button ${
            day === currentDay ? 'current' :
            day < currentDay ? 'past' :
            'future'
          }`}
          disabled={plan.plan_type === 'LIVE' && day !== currentDay}
          onClick={() => {
            if (plan.plan_type === 'TEMPLATE') {
              navigateToDay(day);
            }
          }}
        >
          <span className="day-number">D√≠a {day}</span>
          {day === currentDay && plan.plan_type === 'LIVE' && (
            <span className="live-badge">HOY</span>
          )}
          {day > currentDay && plan.plan_type === 'LIVE' && (
            <span className="lock-icon">üîí</span>
          )}
        </button>
      ))}
    </div>
  );
}
```

---

*Gu√≠a visual creada por Claude Code Assistant*
*26 de Diciembre 2024*